<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopify Data API Tester</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .controls {
            display: grid;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        label {
            font-weight: 600;
            color: #333;
            font-size: 0.95em;
        }
        
        input, select {
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .btn-cached {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-live {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .btn-metadata {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .btn-status {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .response-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            min-height: 200px;
        }
        
        .response-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #dee2e6;
        }
        
        .response-title {
            font-weight: 600;
            color: #333;
            font-size: 1.2em;
        }
        
        .response-stats {
            display: flex;
            gap: 20px;
            font-size: 0.9em;
            color: #666;
        }
        
        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .response-body {
            background: #fff;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #dee2e6;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            color: #f5576c;
            background: #ffe6e9;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #f5576c;
        }
        
        .success {
            color: #43e97b;
        }
        
        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #4facfe;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .info-box strong {
            color: #0066cc;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸš€ Shopify Data API Tester</h1>
        <p class="subtitle">Ultra-Lightweight API - Memory Optimized to &lt;2MB</p>
        
        <div class="info-box">
            <strong>ðŸ’¡ TIP:</strong> Use "Get LIVE Data" to fetch fresh data from database (takes 30-60s). 
            Use "Get Cached Data" for instant results.
        </div>
        
        <div class="controls">
            <div class="input-group">
                <label for="apiUrl">API URL:</label>
                <input type="text" id="apiUrl" value="http://localhost:5000" placeholder="http://localhost:5000">
            </div>
            
            <div class="input-group">
                <label for="apiKey">API Key:</label>
                <input type="text" id="apiKey" value="shopify_secure_key_2025" placeholder="Enter API Key">
            </div>
            
            <div class="input-group">
                <label for="limit">Limit (records to fetch):</label>
                <input type="number" id="limit" value="10" min="1" max="100">
            </div>
            
            <div class="input-group">
                <label for="offset">Offset (starting position):</label>
                <input type="number" id="offset" value="0" min="0">
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn-cached" onclick="fetchData('cached')">
                âš¡ Get Cached Data<br><small>(Fast - &lt;100ms)</small>
            </button>
            <button class="btn-live" onclick="fetchData('live')">
                ðŸ”´ Get LIVE Data<br><small>(Fresh - 30-60s)</small>
            </button>
            <button class="btn-metadata" onclick="fetchData('metadata')">
                ðŸ“Š Get Metadata<br><small>(Super fast)</small>
            </button>
            <button class="btn-status" onclick="fetchData('status')">
                âœ… Check Status<br><small>(Health check)</small>
            </button>
        </div>
        
        <div class="response-container">
            <div class="response-header">
                <div class="response-title">Response:</div>
                <div class="response-stats">
                    <div class="stat" id="statusCode"></div>
                    <div class="stat" id="responseTime"></div>
                    <div class="stat" id="recordCount"></div>
                </div>
            </div>
            <div class="response-body" id="response">
                <div style="text-align: center; color: #999; padding: 40px;">
                    Click a button above to test the API
                </div>
            </div>
        </div>
    </div>
    
    <script>
        async function fetchData(mode) {
            const apiUrl = document.getElementById('apiUrl').value;
            const apiKey = document.getElementById('apiKey').value;
            const limit = document.getElementById('limit').value;
            const offset = document.getElementById('offset').value;
            const responseDiv = document.getElementById('response');
            const statusCode = document.getElementById('statusCode');
            const responseTime = document.getElementById('responseTime');
            const recordCount = document.getElementById('recordCount');
            
            // Build URL based on mode
            let url = apiUrl;
            if (mode === 'cached') {
                url += `/fetch-data?limit=${limit}&offset=${offset}`;
            } else if (mode === 'live') {
                url += `/fetch-data?force_fresh=true&limit=${limit}&offset=${offset}`;
            } else if (mode === 'metadata') {
                url += `/fetch-data?metadata_only=true`;
            } else if (mode === 'status') {
                url += `/status`;
            }
            
            // Show loading
            responseDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div><strong>Loading...</strong></div>
                    ${mode === 'live' ? '<div style="margin-top: 10px;">Fetching fresh data from database (30-60s)</div>' : ''}
                </div>
            `;
            statusCode.innerHTML = '';
            responseTime.innerHTML = '';
            recordCount.innerHTML = '';
            
            // Disable all buttons
            document.querySelectorAll('button').forEach(btn => btn.disabled = true);
            
            try {
                const startTime = performance.now();
                
                const response = await fetch(url, {
                    headers: {
                        'X-API-Key': apiKey
                    }
                });
                
                const endTime = performance.now();
                const elapsed = ((endTime - startTime) / 1000).toFixed(2);
                
                const data = await response.json();
                
                // Update stats
                statusCode.innerHTML = `<strong>Status:</strong> <span class="${response.ok ? 'success' : 'error'}">${response.status}</span>`;
                responseTime.innerHTML = `<strong>Time:</strong> ${elapsed}s`;
                
                if (data.count) {
                    recordCount.innerHTML = `<strong>Count:</strong> ${data.count}`;
                } else if (data.data && Array.isArray(data.data)) {
                    recordCount.innerHTML = `<strong>Records:</strong> ${data.data.length}`;
                }
                
                // Display response
                responseDiv.innerHTML = JSON.stringify(data, null, 2);
                
                if (!response.ok) {
                    responseDiv.innerHTML = `<div class="error"><strong>Error ${response.status}:</strong><br>${JSON.stringify(data, null, 2)}</div>`;
                }
                
            } catch (error) {
                responseDiv.innerHTML = `<div class="error"><strong>Error:</strong><br>${error.message}</div>`;
                statusCode.innerHTML = '<strong>Status:</strong> <span class="error">Error</span>';
            } finally {
                // Re-enable buttons
                document.querySelectorAll('button').forEach(btn => btn.disabled = false);
            }
        }
    </script>
</body>
</html>
